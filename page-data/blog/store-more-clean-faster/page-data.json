{"componentChunkName":"component---src-templates-blog-post-blog-post-tsx","path":"/blog/store-more-clean-faster","result":{"data":{"contentfulBlogPost":{"id":"674361dc-575e-5943-9fca-e6dfac42e9d9","slug":"store-more-clean-faster","industry":"Performance improvements","title":{"title":"Store more, clean faster: CleanStorage job optimized for S3 and MinIO"},"seoTitle":"Store more, clean faster","seoDescription":"We're pleased to announce performance improvements: The CleanStorage job has been optimized for both S3 and MinIO.","featuredImage":{"file":{"url":"//images.ctfassets.net/1n1nntnzoxp4/UwooAbVwEvmwIRFhUng2c/329deb42838571300f551abc19ac7cd1/brown.svg"}},"date":"July 26, 2023","author":"ReportPortal Team","articleBody":{"raw":"{\"data\":{},\"content\":[{\"data\":{},\"content\":[{\"data\":{},\"marks\":[],\"value\":\"We are glad to announce the changes in the logic of the cleanStorage starting from the version 5.8.1 of Service Jobs and API Service version 5.9.0.\",\"nodeType\":\"text\"}],\"nodeType\":\"paragraph\"},{\"data\":{},\"content\":[{\"data\":{},\"marks\":[],\"value\":\"Previously, it was only possible to clear 1 attachment per 1 request to the binary storage, and it was not possible to clear more than 500,000 attachments per 1 job execution. The current implementation allows to clean multiple blobs (200,000) per 1 request to the S3 storage.\",\"nodeType\":\"text\"}],\"nodeType\":\"paragraph\"},{\"data\":{},\"content\":[{\"data\":{},\"marks\":[],\"value\":\"The chunk_size env variable remains for the service jobs (no changes in the deployment are needed). But under the hood, the job logic is splitting chunk_size value into fixed batches by 200k and processing deletion via a certain number of iterations, which is calculated based on chunk size. If chunk_size = 2 million, then the job will proceed with the deletion with 10 iterations and clean 200k attachments per iteration.\",\"nodeType\":\"text\"}],\"nodeType\":\"paragraph\"},{\"data\":{},\"content\":[{\"data\":{},\"marks\":[],\"value\":\"The new logic is 30 times faster for both S3 and MinIO binary storages\",\"nodeType\":\"text\"}],\"nodeType\":\"heading-2\"},{\"data\":{\"target\":{\"sys\":{\"id\":\"Haq4WOWQa84702B9xiU56\",\"type\":\"Link\",\"linkType\":\"Asset\"}}},\"content\":[],\"nodeType\":\"embedded-asset-block\"},{\"data\":{},\"content\":[{\"data\":{},\"marks\":[{\"type\":\"bold\"}],\"value\":\"Use case 1:\",\"nodeType\":\"text\"},{\"data\":{},\"marks\":[],\"value\":\" if chunk_size is set to 200,000, the cleanStorage job will delete 200,000 MAX attachments from the S3 storage within 1 iteration. If the attachments count in the attacment_deletion table is less than 200,000, then all attachments will be deleted.\",\"nodeType\":\"text\"}],\"nodeType\":\"paragraph\"},{\"data\":{},\"content\":[{\"data\":{},\"marks\":[{\"type\":\"bold\"}],\"value\":\"Use case 2:\",\"nodeType\":\"text\"},{\"data\":{},\"marks\":[],\"value\":\" if chunk_size is set to 2 million, the cleanStorage job will delete all attachments from the S3 storage within 10 iterations by batches of 200,000 attachments.\",\"nodeType\":\"text\"}],\"nodeType\":\"paragraph\"},{\"data\":{\"target\":{\"sys\":{\"id\":\"1mJFEBfBHwoeQOZe488lu3\",\"type\":\"Link\",\"linkType\":\"Asset\"}}},\"content\":[],\"nodeType\":\"embedded-asset-block\"},{\"data\":{\"target\":{\"sys\":{\"id\":\"3ZfsczCXTD1mgOo4w6FJpl\",\"type\":\"Link\",\"linkType\":\"Asset\"}}},\"content\":[],\"nodeType\":\"embedded-asset-block\"},{\"data\":{\"target\":{\"sys\":{\"id\":\"Nz4JKSIXNW3WKJ6hPCWiv\",\"type\":\"Link\",\"linkType\":\"Asset\"}}},\"content\":[],\"nodeType\":\"embedded-asset-block\"},{\"data\":{},\"content\":[{\"data\":{},\"marks\":[],\"value\":\"Thus, thanks to this implementation, we have significantly optimized the cleanStorage job performance. It keeps your binary storage within limits and allows you not to care about attachment cleaning. Since we've significantly speeded up the cleanup of binaries, we assume that this should completely solve all such problems.\",\"nodeType\":\"text\"}],\"nodeType\":\"paragraph\"}],\"nodeType\":\"document\"}","references":[{"contentful_id":"Haq4WOWQa84702B9xiU56","__typename":"ContentfulAsset","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=343&h=237&q=50&fm=webp 343w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=686&h=474&q=50&fm=webp 686w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=1372&h=948&q=50&fm=webp 1372w","sizes":"(min-width: 1372px) 1372px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=1372&h=948&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=343&h=237&fl=progressive&q=50&fm=jpg 343w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=686&h=474&fl=progressive&q=50&fm=jpg 686w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Haq4WOWQa84702B9xiU56/90fc53e016c2b1a3e0c94743b55b99ba/CleanStorageJob.jpg?w=1372&h=948&fl=progressive&q=50&fm=jpg 1372w","sizes":"(min-width: 1372px) 1372px, 100vw"}},"layout":"constrained","backgroundColor":"#f8f8f8","width":1372,"height":947.9999999999999},"description":"The new logic of the CleanStorage in our test automation results dashboard"},{"contentful_id":"1mJFEBfBHwoeQOZe488lu3","__typename":"ContentfulAsset","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=396&h=91&q=50&fm=webp 396w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=791&h=182&q=50&fm=webp 791w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=1582&h=363&q=50&fm=webp 1582w","sizes":"(min-width: 1582px) 1582px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=1582&h=363&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=396&h=91&fl=progressive&q=50&fm=jpg 396w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=791&h=182&fl=progressive&q=50&fm=jpg 791w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/1mJFEBfBHwoeQOZe488lu3/e2f8136eda9f4dafb13e780ef01f6cf1/ChunkSize.jpg?w=1582&h=363&fl=progressive&q=50&fm=jpg 1582w","sizes":"(min-width: 1582px) 1582px, 100vw"}},"layout":"constrained","backgroundColor":"#f8f8f8","width":1582,"height":363},"description":"Deleting attachments from the S3 storage depending on chunk_size"},{"contentful_id":"3ZfsczCXTD1mgOo4w6FJpl","__typename":"ContentfulAsset","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=396&h=60&q=50&fm=webp 396w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=791&h=121&q=50&fm=webp 791w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=1582&h=241&q=50&fm=webp 1582w","sizes":"(min-width: 1582px) 1582px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=1582&h=241&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=396&h=60&fl=progressive&q=50&fm=jpg 396w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=791&h=121&fl=progressive&q=50&fm=jpg 791w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/3ZfsczCXTD1mgOo4w6FJpl/19722357ca9b2eee9aa2f2bbcb9b7888/CleaningTime.jpg?w=1582&h=241&fl=progressive&q=50&fm=jpg 1582w","sizes":"(min-width: 1582px) 1582px, 100vw"}},"layout":"constrained","backgroundColor":"#f8f8f8","width":1582,"height":241},"description":"Cleaning time with old logic and new logic"},{"contentful_id":"Nz4JKSIXNW3WKJ6hPCWiv","__typename":"ContentfulAsset","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=396&h=78&q=50&fm=webp 396w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=791&h=157&q=50&fm=webp 791w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=1582&h=313&q=50&fm=webp 1582w","sizes":"(min-width: 1582px) 1582px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=1582&h=313&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=396&h=78&fl=progressive&q=50&fm=jpg 396w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=791&h=157&fl=progressive&q=50&fm=jpg 791w,\nhttps://images.ctfassets.net/1n1nntnzoxp4/Nz4JKSIXNW3WKJ6hPCWiv/91a09609934a34276ab38bd156bf3f45/Logs.jpg?w=1582&h=313&fl=progressive&q=50&fm=jpg 1582w","sizes":"(min-width: 1582px) 1582px, 100vw"}},"layout":"constrained","backgroundColor":"#182838","width":1582,"height":313},"description":"Logs after optimization of cleanStorage job"}]}}},"pageContext":{"slug":"store-more-clean-faster"}},"staticQueryHashes":["1130895138","2991584196","3617663447"],"slicesMap":{}}